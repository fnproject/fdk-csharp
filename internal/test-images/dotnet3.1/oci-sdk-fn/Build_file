ARG DOTNET_VERSION=latest
ARG PKG_VERSION=1.0.0-SNAPSHOT

FROM fnproject/dotnet:${DOTNET_VERSION}-${PKG_VERSION}-dev as build-stage
ARG PKG_VERSION=1.0.0-SNAPSHOT
WORKDIR /function
COPY . .
RUN mkdir ./fdk-repo/
RUN mv Fnproject.Fn.Fdk.${PKG_VERSION}.nupkg ./fdk-repo/
RUN dotnet build -o ./out -c Release

FROM fnproject/dotnet:${DOTNET_VERSION}-${PKG_VERSION}
WORKDIR /function
COPY --from=build-stage /function/out .
CMD ["dotnet", "oci-sdk-fn.dll", "Function:OCISDK:GetCompartmentID"]
